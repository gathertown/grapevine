# =============================================================================
# Grapevine Environment Configuration
# =============================================================================
#
# Copy this file to .env and fill in the values for your deployment.
# Variables marked as [REQUIRED] must be set for the system to function.
# Variables marked as [OPTIONAL] enable additional features when configured.
#
# For local development with Docker Compose, many defaults work out of the box.
# See docs/SELF_HOSTING.md for detailed deployment instructions.
# =============================================================================


# =============================================================================
# REQUIRED: Core Infrastructure
# =============================================================================
# These variables are required for the system to function.

# --- PostgreSQL Database ---
# Control database stores tenant registry, subscriptions, and system metadata
# Uses pgvector extension for embeddings
CONTROL_DATABASE_URL=postgresql://postgres:postgres@localhost:5422/grapevine_control

# --- OpenSearch ---
# Full-text search engine for document indexing
OPENSEARCH_DOMAIN_HOST=localhost
OPENSEARCH_PORT=9200
OPENSEARCH_ADMIN_USERNAME=admin
OPENSEARCH_ADMIN_PASSWORD=admin123!
# Set to any value to enable HTTPS (comment out for local dev)
# OPENSEARCH_USE_SSL=true

# --- OpenAI ---
# Required for document embeddings and AI-powered features
OPENAI_API_KEY=sk-your-openai-api-key-here
# Optional: Custom OpenAI-compatible endpoint
# OPENAI_BASE_URL=https://api.openai.com/v1

# --- Redis ---
# Used for caching, session management, and usage tracking
REDIS_PRIMARY_ENDPOINT=redis://localhost:6379

# --- AWS Configuration ---
# For local development, use LocalStack. In production, use real AWS.
AWS_REGION=us-east-1
# LocalStack endpoint for local development (comment out for production)
AWS_ENDPOINT_URL=http://localhost:4566
# AWS credentials (not needed when using LocalStack locally)
# AWS_ACCESS_KEY_ID=
# AWS_SECRET_ACCESS_KEY=
# AWS_SESSION_TOKEN=

# --- AWS KMS ---
# Encryption key for secure credential storage
# For LocalStack, this is created automatically by localstack_init.py
KMS_KEY_ID=alias/sqs-extended-client

# --- AWS SQS Queues ---
# FIFO queues for async job processing
# Format: queue name (local) or full ARN (production)
INDEX_JOBS_QUEUE_ARN=corporate-context-index-jobs.fifo
INGEST_JOBS_QUEUE_ARN=corporate-context-ingest-jobs.fifo
SLACK_JOBS_QUEUE_ARN=corporate-context-slack-jobs.fifo

# --- S3 Storage ---
# Bucket for large webhook payloads and file storage
S3_BUCKET_NAME=corporate-context-local
INGEST_WEBHOOK_DATA_S3_BUCKET_NAME=corporate-context-ingest-webhook-data-local

# --- Authentication (WorkOS) ---
# WorkOS provides authentication and SSO capabilities
# Get these from your WorkOS dashboard: https://dashboard.workos.com
WORKOS_API_KEY=sk_test_your-workos-api-key
WORKOS_CLIENT_ID=client_your-workos-client-id
# AuthKit domain for MCP authentication
AUTHKIT_DOMAIN=https://your-project.authkit.app

# --- Application URLs ---
# Base domain used for URL generation and CORS
BASE_DOMAIN=localhost
# Frontend application URL
FRONTEND_URL=http://localhost:5173
# MCP server base URL (for external access)
MCP_BASE_URL=http://localhost:8000


# =============================================================================
# REQUIRED: Tenant Database Provisioner (Steward Service)
# =============================================================================
# Configuration for automatic tenant database provisioning.
# The steward service creates isolated databases for each tenant.

# Host where tenant databases are created
PG_TENANT_DATABASE_HOST=localhost
# Port for tenant database connections
PG_TENANT_DATABASE_PORT=5422
# Admin credentials for creating tenant databases (requires CREATE DATABASE privileges)
PG_TENANT_DATABASE_ADMIN_USERNAME=postgres
PG_TENANT_DATABASE_ADMIN_PASSWORD=postgres
# Default database to connect to for admin operations
PG_TENANT_DATABASE_ADMIN_DB=postgres
# SSL mode for tenant connections (disable for local dev, require for production)
PG_TENANT_DATABASE_SSLMODE=disable


# =============================================================================
# OPTIONAL: Slack Bot Integration
# =============================================================================
# Configure these to enable the Slack bot for Q&A functionality.
# Create a Slack app at https://api.slack.com/apps

# Bot token (xoxb-...) - found in OAuth & Permissions
# SLACK_BOT_TOKEN=xoxb-your-bot-token

# Signing secret - found in Basic Information
# SLACK_SIGNING_SECRET=your-signing-secret

# App token (xapp-...) - required for Socket Mode
# SLACK_APP_TOKEN=xapp-your-app-token

# Enable Socket Mode for development (set to any value to enable)
# SOCKET_MODE=true

# Internal JWT configuration for Slack bot to MCP communication
# Generate RSA key pair: openssl genrsa -out private.pem 2048
#                        openssl rsa -in private.pem -pubout -out public.pem
# INTERNAL_JWT_PRIVATE_KEY="-----BEGIN RSA PRIVATE KEY-----\n...\n-----END RSA PRIVATE KEY-----"
# INTERNAL_JWT_PUBLIC_KEY="-----BEGIN PUBLIC KEY-----\n...\n-----END PUBLIC KEY-----"
# INTERNAL_JWT_ISSUER=grapevine-slack-bot
# INTERNAL_JWT_AUDIENCE=grapevine-mcp


# =============================================================================
# OPTIONAL: Analytics & Observability
# =============================================================================
# All analytics services are optional. The system functions without them.

# --- Amplitude (User Analytics) ---
# VITE_AMPLITUDE_API_KEY=your-amplitude-api-key

# --- PostHog (Product Analytics & Feature Flags) ---
# VITE_POSTHOG_API_KEY=your-posthog-api-key
# VITE_POSTHOG_HOST=https://us.i.posthog.com
# VITE_POSTHOG_UI_HOST=https://us.posthog.com

# --- Langfuse (LLM Observability) ---
# LANGFUSE_PUBLIC_KEY=pk-lf-your-public-key
# LANGFUSE_SECRET_KEY=sk-lf-your-secret-key
# LANGFUSE_HOST=https://us.cloud.langfuse.com
# Set to false to disable all tracing
# TRACING_ENABLED=true

# --- New Relic (Application Performance Monitoring) ---
# Backend (Python/Node.js)
# NEW_RELIC_LICENSE_KEY=your-new-relic-license-key

# Frontend (Browser) - all 5 are required for frontend monitoring
# VITE_NEW_RELIC_LICENSE_KEY=your-new-relic-license-key
# VITE_NEW_RELIC_APPLICATION_ID=your-application-id
# VITE_NEW_RELIC_ACCOUNT_ID=your-account-id
# VITE_NEW_RELIC_TRUST_KEY=your-trust-key
# VITE_NEW_RELIC_AGENT_ID=your-agent-id


# =============================================================================
# OPTIONAL: Billing & Payments (Stripe)
# =============================================================================
# Configure Stripe to enable subscription management and usage-based billing.
# Without these, all tenants have unlimited usage.

# STRIPE_SECRET_KEY=sk_test_your-stripe-secret-key
# STRIPE_WEBHOOK_SECRET=whsec_your-webhook-secret

# Stripe Price IDs for subscription tiers (create in Stripe dashboard)
# STRIPE_PRICE_ID_BASIC_MONTHLY=price_xxx
# STRIPE_PRICE_ID_TEAM_MONTHLY=price_xxx
# STRIPE_PRICE_ID_PRO_MONTHLY=price_xxx
# STRIPE_PRICE_ID_ULTRA_MONTHLY=price_xxx


# =============================================================================
# OPTIONAL: Email Delivery (Mailgun)
# =============================================================================
# Configure for sending invitation emails.
# WorkOS also sends emails based on its dashboard configuration.

# MAILGUN_API_KEY=your-mailgun-api-key
# MAILGUN_DOMAIN=mail.yourdomain.com
# MAILGUN_FROM_EMAIL=noreply@yourdomain.com


# =============================================================================
# OPTIONAL: Connector OAuth Configuration
# =============================================================================
# Configure OAuth credentials for each data source you want to support.
# Users will connect these via the admin UI.

# --- GitHub ---
# Create OAuth App: https://github.com/settings/developers
# GITHUB_CLIENT_ID=your-github-client-id
# GITHUB_CLIENT_SECRET=your-github-client-secret

# --- GitLab ---
# Create Application: https://gitlab.com/-/profile/applications
# GITLAB_CLIENT_ID=your-gitlab-client-id
# GITLAB_CLIENT_SECRET=your-gitlab-client-secret
# VITE_GITLAB_CLIENT_ID=your-gitlab-client-id

# --- Slack ---
# Create App: https://api.slack.com/apps
# SLACK_CLIENT_ID=your-slack-client-id
# SLACK_CLIENT_SECRET=your-slack-client-secret

# --- Linear ---
# Create OAuth Application: https://linear.app/settings/api/applications
# LINEAR_CLIENT_ID=your-linear-client-id
# LINEAR_CLIENT_SECRET=your-linear-client-secret

# --- Notion ---
# Create Integration: https://www.notion.so/my-integrations
# (OAuth credentials are stored per-tenant in SSM)

# --- Google Drive / Gmail ---
# Create OAuth credentials in Google Cloud Console
# Service account JSON for control plane operations
# GOOGLE_DRIVE_CONTROL_SERVICE_ACCOUNT={"type":"service_account",...}

# --- Jira (Forge App) ---
# JIRA_APP_ID=your-jira-app-uuid
# VITE_JIRA_APP_ID=your-jira-app-uuid
# VITE_JIRA_APP_ENVIRONMENT_ID=your-environment-id
# VITE_JIRA_APP_INSTALLATION_URL=https://...

# --- Confluence (Forge App) ---
# CONFLUENCE_APP_ID=your-confluence-app-uuid
# VITE_CONFLUENCE_APP_ID=your-confluence-app-uuid
# VITE_CONFLUENCE_APP_ENVIRONMENT_ID=your-environment-id
# VITE_CONFLUENCE_APP_INSTALLATION_URL=https://...

# --- Trello (Power-Up) ---
# TRELLO_POWER_UP_API_KEY=your-trello-api-key
# TRELLO_POWER_UP_SECRET=your-trello-secret
# TRELLO_POWER_UP_ID=your-power-up-id
# VITE_TRELLO_POWER_UP_API_KEY=your-trello-api-key

# --- HubSpot ---
# Create Private App: https://developers.hubspot.com/
# (OAuth credentials stored per-tenant in SSM)

# --- Salesforce ---
# Create Connected App in Salesforce Setup
# SALESFORCE_CLIENT_ID=your-salesforce-client-id
# SALESFORCE_CLIENT_SECRET=your-salesforce-client-secret
# VITE_SALESFORCE_CLIENT_ID=your-salesforce-client-id

# --- Intercom ---
# Create Developer App: https://developers.intercom.com/
# INTERCOM_CLIENT_ID=your-intercom-client-id
# INTERCOM_CLIENT_SECRET=your-intercom-client-secret
# VITE_INTERCOM_CLIENT_ID=your-intercom-client-id

# --- Monday.com ---
# Create App: https://monday.com/developers/apps
# MONDAY_CLIENT_ID=your-monday-client-id
# MONDAY_CLIENT_SECRET=your-monday-client-secret
# MONDAY_SIGNING_SECRET=your-monday-signing-secret

# --- Figma ---
# Create App: https://www.figma.com/developers
# FIGMA_CLIENT_ID=your-figma-client-id
# FIGMA_CLIENT_SECRET=your-figma-client-secret

# --- Canva ---
# Create Integration: https://www.canva.com/developers/
# CANVA_CLIENT_ID=your-canva-client-id
# CANVA_CLIENT_SECRET=your-canva-client-secret

# --- Pipedrive ---
# Create App: https://developers.pipedrive.com/
# PIPEDRIVE_CLIENT_ID=your-pipedrive-client-id
# PIPEDRIVE_CLIENT_SECRET=your-pipedrive-client-secret

# --- Teamwork ---
# Create App in Teamwork Developer Portal
# TEAMWORK_CLIENT_ID=your-teamwork-client-id
# TEAMWORK_CLIENT_SECRET=your-teamwork-client-secret

# --- Gong (for local development) ---
# GONG_API_BASE_URL=https://api.gong.io
# GONG_ACCESS_TOKEN=your-gong-access-token


# =============================================================================
# OPTIONAL: Development & Debugging
# =============================================================================

# Environment name (local, staging, production)
GRAPEVINE_ENVIRONMENT=local

# Enable debug mode for additional logging
# DEBUG_MODE=true

# Disable authentication for local testing (NOT for production!)
# AUTH_ENABLED=false
# DEV_ORG_ID=test-org-id

# Log level (debug, info, warning, error)
# LOG_LEVEL=info


# =============================================================================
# ADVANCED: Worker Configuration
# =============================================================================
# Tune these for production deployments

# Queue processing settings
# QUEUE_MAX_RETRIES=3
# QUEUE_RETRY_DELAY=30
# QUEUE_BATCH_SIZE=10
# QUEUE_MAX_JOB_AGE=86400

# Agent configuration
# AGENT_MAX_MESSAGES=100
# AGENT_OPENAI_TIMEOUT=180
# AGENT_TOOL_TIMEOUT=60
# AGENT_DEBUG=false

# Worker ports (for running multiple instances)
# INGEST_HTTP_PORT=8080
# INDEX_HTTP_PORT=8081

# Slack bot concurrency
# SLACK_BOT_MAX_CONCURRENCY=10


# =============================================================================
# ADVANCED: Service URLs (for distributed deployments)
# =============================================================================
# Override these when services run on different hosts

# Ambient extraction service URL
# AMBIENT_EXTRACTION_BASE_URL=http://localhost:8004

# Gatekeeper service URL
# GATEKEEPER_URL=http://localhost:8001

# Admin backend port
# ADMIN_WEB_UI_BACKEND_PORT=5002


# =============================================================================
# ADVANCED: LocalStack SSM Seed (Development Only)
# =============================================================================
# Pre-populate SSM parameters for local development
# Format: JSON object with key-value pairs
# LOCALSTACK_SSM_SEED={"tenant123/signing-secret/github": "test-secret"}

name: Assign Linear Ticket to Devin

on:
  workflow_dispatch:
    inputs:
      linear_ticket_id:
        description: 'Linear Ticket ID (e.g., ENG-123 or UUID)'
        required: true
        type: string
      base_branch:
        description: 'Base branch for the PR'
        required: false
        default: 'main'
        type: string

permissions:
  contents: write
  pull-requests: write
  actions: write

jobs:
  assign-to-devin:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Assign Linear Ticket to Devin
        id: assign
        uses: ./.github/actions/dispatcher
        with:
          LINEAR_TICKET_ID: ${{ inputs.linear_ticket_id }}
          BASE_BRANCH: ${{ inputs.base_branch }}
          LINEAR_API_KEY: ${{ secrets.TEST_PLAN_LINEAR_API_KEY }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          CURSOR_API_KEY: ${{ secrets.CURSOR_API_KEY }}
          DEVIN_API_KEY: ${{ secrets.TEST_PLAN_DEVIN_API_KEY }}

      - name: Summary
        run: |
          {
            echo "## Linear Ticket Assigned to Devin"
            echo ""
            echo "**Linear Ticket:** [${{ steps.assign.outputs.identifier }}](${{ steps.assign.outputs.url }})"
            echo "**Title:** ${{ steps.assign.outputs.title }}"
            echo ""
            echo "**Branch:** \`${{ steps.assign.outputs.branch_name }}\`"
            echo "**Draft PR:** [#${{ steps.assign.outputs.pr_number }}](${{ steps.assign.outputs.pr_url }})"
            echo ""
            echo "**Devin Session:** [${{ steps.assign.outputs.session_id }}](${{ steps.assign.outputs.session_url }})"
          } >> "$GITHUB_STEP_SUMMARY"

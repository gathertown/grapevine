# Sample Questions CLI

A command-line tool for examining sample questions and answers from tenant databases with clean, formatted output.

## Overview

The Sample Questions CLI provides an easy way to view and analyze the sample questions and answers generated by the Corporate Context system. It connects directly to tenant databases to display questions with rich formatting, metadata, and statistics.

## Prerequisites

Ensure you have the required environment variables set for database access.

### Local Development
```bash
# For local tenant databases
uv run python -m src.sample_questions.cli <command> <tenant_id>
```

### Production Access
```bash
# For production tenant databases
uv run python -m src.sample_questions.cli <command> <tenant_id>
```

⚠️ **IMPORTANT**: When accessing production data, you are handling potentially sensitive customer information. Always:
- Follow your organization's data handling policies
- Limit access to authorized personnel only
- Do not copy or store production data locally
- Use appropriate care when sharing or discussing the data

## Installation

The CLI uses the existing project dependencies. Make sure you have installed the project requirements:

```bash
uv sync
```

## Usage

The CLI provides three main commands: `unanswered`, `answered`, and `stats`. All commands require a tenant ID as the first argument.

### Basic Usage

```bash
uv run python -m src.sample_questions.cli <command> <tenant_id> [options]
```

### Commands

#### 1. View Unanswered Questions

Display questions that haven't been answered yet:

```bash
# Show top 10 unanswered questions
uv run python -m src.sample_questions.cli unanswered abc123def456

# Show 20 questions with minimum score of 0.5
uv run python -m src.sample_questions.cli unanswered abc123def456 --limit 20 --min-score 0.5

# Filter by source (e.g., slack)
uv run python -m src.sample_questions.cli unanswered abc123def456 --source slack
```

**Options:**
- `--limit, -n`: Number of questions to show (default: 10)
- `--source`: Filter by source (e.g., 'slack', 'github')
- `--min-score`: Minimum score threshold for questions

#### 2. View Answered Questions

Display questions that have been answered, with their responses:

```bash
# Show top 10 answered questions with full answers
uv run python -m src.sample_questions.cli answered abc123def456

# Show without full answer text (summary only)
uv run python -m src.sample_questions.cli answered abc123def456 --no-answers

# Filter by confidence score
uv run python -m src.sample_questions.cli answered abc123def456 --min-confidence 0.8
```

**Options:**
- `--limit, -n`: Number of questions to show (default: 10)
- `--source`: Filter by source (e.g., 'slack', 'github')
- `--min-confidence`: Minimum confidence threshold (0.0-1.0)
- `--show-answers/--no-answers`: Show/hide full answer text (default: show)

#### 3. View Statistics

Get an overview of questions and answers for a tenant:

```bash
# Show comprehensive statistics
uv run python -m src.sample_questions.cli stats abc123def456
```

This command displays:
- Total questions and answers
- Answer rate percentage
- Source breakdown (questions per source)
- Answer quality distribution by confidence level

### Output Format

The CLI provides rich, formatted output with:

- **Color-coded confidence scores**: Green (≥80%), Yellow (60-79%), Red (<60%)
- **Structured question cards**: Full question text, metadata, and context
- **Source attribution**: Shows channel names, usernames, thread activity
- **Clean tables**: For statistics and breakdowns
- **Progress indicators**: Success/error messages with emojis

### Examples

#### Example 1: Quick Overview
```bash
# Get a quick overview of tenant questions
uv run python -m src.sample_questions.cli stats abc123def456
uv run python -m src.sample_questions.cli unanswered abc123def456 --limit 5
```

#### Example 2: Quality Check
```bash
# Check high-quality answered questions
uv run python -m src.sample_questions.cli answered abc123def456 --min-confidence 0.8 --limit 5
```

#### Example 3: Source Analysis
```bash
# Analyze Slack questions specifically
uv run python -m src.sample_questions.cli unanswered abc123def456 --source slack --min-score 0.7
uv run python -m src.sample_questions.cli answered abc123def456 --source slack
```

## Error Handling

The CLI includes comprehensive error handling for common issues:

- **Database connectivity**: Validates connection before running queries
- **Missing credentials**: Clear error messages for missing environment variables
- **Invalid tenant ID**: Connection failures are caught and reported
- **No results**: Informative messages when no questions match criteria

## Development

The CLI is built using:
- **Typer**: For command-line interface and argument parsing
- **Rich**: For formatted output, tables, and colors
- **asyncpg**: For PostgreSQL database connections
- **asyncio**: For async database operations

Key files:
- `src/sample_questions/cli.py`: Main CLI implementation
- Database tables: `sample_questions`, `sample_answers`

## Troubleshooting

### Common Issues

1. **"Cannot connect to tenant database"**
   - Verify the tenant ID exists and is correctly formatted
   - Ensure database server is accessible from your network
   - Check that required environment variables are set

2. **"Tenant database credentials not configured"**
   - Verify you have the required environment variables set
   - Check your AWS credentials are configured

3. **"No questions found"**
   - The tenant may not have any sample questions yet
   - Try adjusting filter criteria (lower `--min-score` or `--min-confidence`)
   - Check if the tenant has completed question extraction

### Performance

- The CLI uses connection pooling and async operations for optimal performance
- Large result sets are automatically limited to prevent overwhelming output
- Database connections are properly closed after each command
